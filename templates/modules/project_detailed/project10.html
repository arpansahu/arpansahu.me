{% extends 'base.html' %}
{% load static %}
<!-- Specific CSS goes HERE -->
{% block stylesheets %}


    <style>
    *, *:before, *:after {
      box-sizing: border-box;
    }

    pre[class*="language-"] {
      position:relative;
      overflow: auto;
      margin:5px 0;
      padding:1.75rem 0 1.75rem 1rem;
      border-radius:10px;
    }

    copy-button{
      position:absolute;
      top:5px;
      right:5px;
      font-size:.9rem;
      padding:.15rem;
      background-color:#828282;
      color: #1e1e1e;
      border:ridge 1px #7b7b7c;
      border-radius:5px;
      text-shadow:#c4c4c4 0 0 2px;
    }

    copy-button:hover{
      cursor:pointer;
       background-color:#bcbabb;
    }

    .img-container {
      width: 100%;
      height: 200px;
      max-height: 240px;
      overflow: hidden;
      margin: 0;
      position: relative;
  }
  
  .img-container img {
      position:absolute;
      top: 50%;
      transform: translateY(-50%);
      max-width: 100%;
  }
    </style>
{% endblock stylesheets %}

{% block content %}

    <!-- start hero -->
    <section class="hero-one position-relative bg-black" id="about"  style="background-image: url('{% static "images/personal/main-bg.png" %}'); background-size: cover; background-position: center center;">
        <div class="container">
            <div class="row align-items-center justify-content-center py-100">
                <div class="col-lg-12 text-center py-12 text-center">
                    <h5 class="head-title py-12" aria-label="arpansahu.me"></h5>
                </div><!--end col-->
            </div><!--end row-->
        </div><!-- end container -->
    </section>
    <!-- end hero -->

    <!-- start hero -->
    <section class="hero-one position-relative bg-black" id="home"  style="background-image: url('{% static "images/personal/main-bg.png" %}'); background-size: cover; background-position: center center;">
        <div class="row align-items-center justify-content-center" style="padding: 5px; align-items: center; text-align: center">
            <h4 style="color: white">Django Portfolio Project</h4>
        </div>
        <div class="row align-items-center justify-content-center" style="padding: 5px">
            <div class="col-lg-8  mx-auto">
              <div class="col-md-8 mx-auto">
                <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                  <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1" style="background-color: black"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2" style="background-color: black"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3" style="background-color: black"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4" style="background-color: black"></button>
                    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4" aria-label="Slide 5" style="background-color: black"></button>
                  </div>
                  <div class="carousel-inner border-radius-sm">
                    <div class="carousel-item active">
                      <img class="d-block w-100" src="{% static 'images/sliders/project10/project10_1.png' %}" alt="First slide" />
                        <div class="carousel-caption d-none d-md-block" style="color: black">
                          <h5>About</h5>
                          <p></p>
                        </div>
                    </div>
                    <div class="carousel-item">
                      <img class="d-block w-100" src="{% static 'images/sliders/project10/project10_2.png' %}" alt="Second slide" />
                        <div class="carousel-caption d-none d-md-block" style="color: black">
                          <h5>Skills</h5>
                          <p></p>
                        </div>
                    </div>
                    <div class="carousel-item">
                      <img class="d-block w-100" src="{% static 'images/sliders/project10/project10_3.png' %}" alt="Third slide" />
                        <div class="carousel-caption d-none d-md-block" style="color: black">
                          <h5>Education and Experience</h5>
                          <p></p>
                        </div>
                    </div>
                    <div class="carousel-item">
                      <img class="d-block w-100" src="{% static 'images/sliders/project10/project10_4.png' %}" alt="Fourth slide" />
                        <div class="carousel-caption d-none d-md-block" style="color: black">
                          <h5>Projects</h5>
                          <p></p>
                        </div>
                    </div>
                    <div class="carousel-item">
                      <img class="d-block w-100" src="{% static 'images/sliders/project10/project10_5.png' %}" alt="Fifth slide" />
                        <div class="carousel-caption d-none d-md-block" style="color: black">
                          <h5>Contact</h5>
                          <p></p>
                        </div>
                    </div>
                  </div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon bg-success" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                    <span class="carousel-control-next-icon bg-success" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
              </div>
            </div><!--end col-->

            <div class="col-lg-4 text-center px-0 px-xl-4 mt-5 mt-lg-0 pt-5 pt-lg-0">
                <h5 class="d-inline-block py-1 px-3 rounded text-muted font-secondary" style="color: white">Technologies Used</h5>
                <span class="wrap"></span>
                <div class="mb-4 mb-lg-0">
                    <div class="d-inline-block">
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Python</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Django</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Jquery</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">HTML</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">CSS</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Bootstrap</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Javascript</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Amazon Web Services</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Mail Jet</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Heroku</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Github</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">AWS</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Nginx</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Docker</span>
                        <span class="badge badge-lg rounded bg-soft-alt-info fw-normal fs-12 text-uppercase">Jenkins</span>
                    </div>
                </div>

                <div class="mb-5 mb-lg-0" style="margin-top: 15px">
                    <a class="btn btn-block btn-social btn-github" href="https://github.com/arpansahu/arpansahu.me" target="_blank" style="color: white">
                        <span class="fa fa-github" style="margin-right: 10px; color: white"></span> Check Repo
                    </a>
                    <a class="btn btn-block btn-social btn-github" href="https://www.arpansahu.me/" target="_blank" style="color: white">
                        <span class="fa fa-youtube" style="margin-right: 10px; color: white"></span> Live Demo
                    </a>
                </div>
            </div><!--end col-->
        </div><!--end row-->
    </section>
     <!-- end hero -->
     <div class="container-fluid py-4" style="background-color: black">
        <div class="row" style="border-radius: 10px">
          <div class="col-12" style="border-radius: 10px">
            <div class="card mb-12" style="border-radius: 20px">
                <div style="padding: 20px; border-radius: 10px">
                        <h2>Description</h2><hr>
                        <p>This project is implementation for the following topics related to technologies used with Django</p><br>
                            <p>-Build Portfolio Using Bootstrap 5.</p>
                                <ol>
                                    <li>Used Bootstrap for building UI and Django as Backend.</li>
                                    <li>Used DropBox API for showing updated Resumes.</li>
                                    <li>Used Javascript / Jquery for making templates Dynamic</li>
                                    <li>Used SMTP to notify my whenever someone tries to message me on arpansahu.me</li>
                                    <li>Used AWS S3 Bucket</li>
                                    <li>Since Heroku doesn't allow to send mail using SMTP, Integrated Mail Jet</li>
                                </ol>
                            <p>-Deployed on Heroku</p>
                                <ol>
                                    <li>Used Heroku Postgres </li>
                                </ol>
                            <h2>Demo</h2><hr>
                            <p><a href="https://www.arpansahu.me/" target="_blank">Available at: https://www.arpansahu.me/</a></p>

                            <h2>License</h2><hr>
                            <p><a href="https://choosealicense.com/licenses/mit/">MIT</a></p>
                            <br>

                            <h2>Integrating AWS S3 Bucket</h2><hr>
                            <p>Install two python packages</p>

<pre><code class="language-python">pip install boto3
pip install django-storages
</code></pre>
                              <p>create a new file named
<pre><code class="language-python">storage_backends.py
</code></pre> with this code inside it.</p>

<pre><code class="language-python">from django.conf import settings
from storages.backends.s3boto3 import S3Boto3Storage


class StaticStorage(S3Boto3Storage):
location = settings.AWS_STATIC_LOCATION


class PublicMediaStorage(S3Boto3Storage):
location = settings.AWS_PUBLIC_MEDIA_LOCATION
file_overwrite = False


class PrivateMediaStorage(S3Boto3Storage):
location = 'private'
default_acl = 'private'
file_overwrite = False
custom_domain = False
</code></pre>
                            <p>Change settings.py static files and media files settings</p>

<pre><code class="language-python">if not DEBUG:
  BUCKET_TYPE = config('BUCKET_TYPE')

  if BUCKET_TYPE == 'AWS':

      AWS_ACCESS_KEY_ID = config('AWS_ACCESS_KEY_ID')
      AWS_SECRET_ACCESS_KEY = config('AWS_SECRET_ACCESS_KEY')
      AWS_STORAGE_BUCKET_NAME = config('AWS_STORAGE_BUCKET_NAME')
      AWS_S3_CUSTOM_DOMAIN = f'{AWS_STORAGE_BUCKET_NAME}.s3.amazonaws.com'
      AWS_DEFAULT_ACL = 'public-read'
      AWS_S3_OBJECT_PARAMETERS = {
          'CacheControl': 'max-age=86400'
      }
      AWS_LOCATION = 'static'
      AWS_QUERYSTRING_AUTH = False
      AWS_HEADERS = {
          'Access-Control-Allow-Origin': '*',
      }
      # s3 static settings
      AWS_STATIC_LOCATION = 'portfolio/arpansahu.me/static'
      STATIC_URL = f'https://{AWS_S3_CUSTOM_DOMAIN}/{AWS_STATIC_LOCATION}/'
      STATICFILES_STORAGE = 'arpansahu_dot_me.storage_backends.StaticStorage'
      # s3 public media settings
      AWS_PUBLIC_MEDIA_LOCATION = 'portfolio/arpansahu.me/media'
      MEDIA_URL = f'https://{AWS_S3_CUSTOM_DOMAIN}/{AWS_PUBLIC_MEDIA_LOCATION}/'
      DEFAULT_FILE_STORAGE = 'arpansahu_dot_me.storage_backends.PublicMediaStorage'
      # s3 private media settings
      PRIVATE_MEDIA_LOCATION = 'portfolio/arpansahu.me/private'
      PRIVATE_FILE_STORAGE = 'arpansahu_dot_me.storage_backends.PrivateMediaStorage'

  elif BUCKET_TYPE == 'BLACKBLAZE':

      AWS_ACCESS_KEY_ID = config('AWS_ACCESS_KEY_ID')
      AWS_SECRET_ACCESS_KEY = config('AWS_SECRET_ACCESS_KEY')
      AWS_STORAGE_BUCKET_NAME = config('AWS_STORAGE_BUCKET_NAME')
      AWS_S3_REGION_NAME = config('AWS_S3_REGION_NAME')

      AWS_S3_ENDPOINT = f's3.{AWS_S3_REGION_NAME}.backblazeb2.com'
      AWS_S3_ENDPOINT_URL = f'https://{AWS_S3_ENDPOINT}'
      
      AWS_DEFAULT_ACL = 'public-read'
      AWS_S3_OBJECT_PARAMETERS = {
          'CacheControl': 'max-age=86400',
      }

      AWS_LOCATION = 'static'
      AWS_QUERYSTRING_AUTH = False
      AWS_HEADERS = {
          'Access-Control-Allow-Origin': '*',
      }
      # s3 static settings
      AWS_STATIC_LOCATION = 'portfolio/arpansahu.me/static'
      STATIC_URL = f'https://{AWS_STORAGE_BUCKET_NAME}.{AWS_STATIC_LOCATION}/'
      STATICFILES_STORAGE = 'arpansahu_dot_me.storage_backends.StaticStorage'
      # s3 public media settings
      AWS_PUBLIC_MEDIA_LOCATION = 'portfolio/arpansahu.me/media'
      MEDIA_URL = f'https://{AWS_STORAGE_BUCKET_NAME}.{AWS_PUBLIC_MEDIA_LOCATION}/'
      DEFAULT_FILE_STORAGE = 'arpansahu_dot_me.storage_backends.PublicMediaStorage'
      # s3 private media settings
      PRIVATE_MEDIA_LOCATION = 'portfolio/arpansahu.me/private'
      PRIVATE_FILE_STORAGE = 'arpansahu_dot_me.storage_backends.PrivateMediaStorage'


else:
  # Static files (CSS, JavaScript, Images)
  # https://docs.djangoproject.com/en/3.2/howto/static-files/

  STATIC_URL = '/static/'

  STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
  MEDIA_URL = '/media/'
  MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

STATICFILES_DIRS = [os.path.join(BASE_DIR, "static"), ]
</code></pre>

                            <p>run below command
<pre><code class="language-python">python manage.py collectstatic
</code></pre> and you are good to go.</p>

                            <h2>Installation</h2><hr>
                            <p>Installing Pre requisites</p>

<pre><code class="language-python">pip install -r requirements.txt
</code></pre>

                            <p>Create .env File</p>

<pre><code class="language-python">add variables mentioned in .env.example
</code></pre>

                            <p>Making Migrations and Migrating them.</p>
<pre><code class="language-python">python manage.py makemigrations
python manage.py migrate
</code></pre>

                            <p>Creating Super User.</p>
<pre><code class="language-python">python manage.py createsuperuser
</code></pre>

                            <h2>Deployment on Heroku</h2><hr>
                            <p>Installing Heroku Cli</p>
<pre><code class="language-python">checkout: https://devcenter.heroku.com/articles/heroku-cli
</code></pre>

                            <p>Create your account in Heroku.</p>
                            <p>Inside your project directory </p>
                            <p>Login Heroku CLI</p>
<pre><code class="language-python">heroku login
</code></pre>
                            <p>Create Heroku App</p>
<pre><code class="language-python">heroku create [app_name]
</code></pre>
                            <p>Push Heroku App</p>
<pre><code class="language-python">git push heroku master
</code></pre>
                            <p>Configure Heroku App Env Variables</p>
<pre><code class="language-python">heroku config:set GITHUB_USERNAME=joesmith
</code></pre>
                            <h2>Configuring Django App for Heroku</h2><hr>
                            <p>Install whitenoise </p>
<pre><code class="language-python">pip install whitenoise
</code></pre>
                            <p>Include it in Middlewares.</p>
<pre><code class="language-python">MIDDLEWARE = [
    # ...
    "django.middleware.security.SecurityMiddleware",
    "whitenoise.middleware.WhiteNoiseMiddleware",
    # ...
]
</code></pre>
                            <p>Create Procfile and include this code snippet in it.</p>
<pre><code class="language-python">web: gunicorn arpansahu_dot_me.wsgi
</code></pre>
                            <h2>Enabling HSTS if Using EC2 to host with Nginx</h2><hr>
                            <p>Add to project/settings.py</p>
<pre><code class="language-python">SECURE_HSTS_SECONDS = 30  # Unit is seconds; *USE A SMALL VALUE FOR TESTING!*
SECURE_HSTS_PRELOAD = True
SECURE_HSTS_INCLUDE_SUBDOMAINS = True
SECURE_PROXY_SSL_HEADER = ("HTTP_X_FORWARDED_PROTO", "https")
</code></pre>
                            <p># Edit your Nginx Config File</p>
<pre><code class="language-python">location / {
  proxy_pass          http://localhost:8000;
  proxy_set_header    Host $host;
  proxy_set_header    X-Forwarded-Proto $scheme;
}
</code></pre>                  
                            <h2>Also Set Referrer-policy Header</h2><hr>
                            <p>Add to project/settings.py</p>    
<pre><code class="language-python">SECURE_REFERRER_POLICY = "strict-origin-when-cross-origin"   
</code></pre>   
                            <h2>Deployment on AWS EC2/ Home Server Ubuntu 22.0 LTS/ Hostinger VPS Server</h2><hr>
                            <p>
                              Previously This project was hosted on Heroku, but so I started hosting this and all other projects in a 
                              Single EC2 Machine, which costed me a lot, so now I have shifted all the projects into my own Home Server with 
                              Ubuntu 22.0 LTS Server, except for portfolio project at https://www.arpansahu.me along with Nginx 


                              Now there is EC2 server running with a nginx server and arpansahu.me portfolio
                              Nginx forward https://arpansahu.me/ to Home Server 

                              Multiple Projects are running inside dockers so all projects are dockerized.
                              You can refer to all projects on https://www.arpansahu.me/projects

                              Every project have different port on which its running predefined inside Dockerfile and docker-compose.yml
                            
                              <img class="d-block w-100" src="{% static 'images/ec2_and_home_server.png' %}" alt="EC2 and Home Server along with Nginx, Docker and Jenkins Arrangement" />
                              <br>
                              Note: Update as of Aug 2023, I have decided to make some changes to my lifestyle, and from now i will be constantly on the go
                                    from my past experience with running free EC2 server for arpansahu.me and nginx in it and then using another home server
                                    with all the other projects hosted, my experience was

                              1. Downtime due to Broadband Service Provider Issues
                              2. Downtime due to Weather Sometimes
                              3. Downtime due to Machine Breakdown
                              4. Downtime due to Power Cuts (even though i had a inverted with battery setup for my room)
                              5. Remotely it would be harder to fix these problems 

                              and due to all these reasons i decided to shift all the projects to single EC2 Server, at first i was using t2.medium which costs more than 40$ a month 
                              then i switched to t2.small and it only costs you 15$ and if we take pre paid plans prices can be slashed much further. 
                              
                              Then again i shifted to Hostinger VPS which was more cost friendly then EC2 Server. on Jan 2024
                              
                              Now My project arrangements looks something similar to this
                              
                              <img class="d-block w-100" src="{% static 'images/one_server_configuration_for_arpanahuone.png' %}" alt="EC2 Sever along with Nginx, Docker and Jenkins Arrangement" />
                              <br>
                            </p>
                            <h3>Step 1 Dockerizing</h3>
                            <p>
                              <h4>Installing Docker on Home Server</h4><br>
                              
                              <a style="color: blue" href="https://docs.docker.com/engine/install/ubuntu/">Reference</a>

                              <ol>
                                <li>Setting up the Repository</li>
                                <ol>
                                  <li>Update the apt package index and install packages to allow apt to use a repository over HTTPS: <br>
<pre><code class="language-python">sudo apt-get update
sudo apt-get install \
ca-certificates \
curl \
gnupg \
lsb-release
</code></pre>         
                                  </li>
                                  <li>Add Docker’s official GPG key: <br>
<pre><code class="language-python">sudo mkdir -p /etc/apt/keyrings
    
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</code></pre>   
                                  </li>
                                  <li>Use the following command to set up the repository:<br>
<pre><code class="language-python">echo \
"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
</code></pre>                     
                                  </li>
                                </ol>
                                <li>Install Docker Engine</li>
                                <ol>
                                  <li>Update the apt package index:<br>
<pre><code class="language-python">sudo apt-get update
</code></pre>  
                                  <ol>
                                    <li>Receiving a GPG error when running apt-get update?<br>
                                      Your default umask may be incorrectly configured, preventing detection of the repository public key file. Try granting read permission for the Docker public key file before updating the package index:<br>
<pre><code class="language-python">sudo chmod a+r /etc/apt/keyrings/docker.gpg
sudo apt-get update
</code></pre>
                                    </li>
                                  </ol>
                                  </li>
                                  <li>Install Docker Engine, containerd, and Docker Compose:<br>
<pre><code class="language-python">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</code></pre>                                 
                                  </li>  
                                  <li>Verify that the Docker Engine installation is successful by running the hello-world image:<br>
<pre><code class="language-python">sudo docker run hello-world
</code></pre>
                                  </li>  
                                </ol>
                              </ol>
                              <h4><br>Now in your Git Repository, Create a file named Dockerfile with no extension and add following lines in it</h4>
<pre><code class="language-python">FROM python:3.10.7

WORKDIR /app

COPY requirements.txt requirements.txt

COPY . .

RUN pip3 install -r requirements.txt

EXPOSE 8000

CMD python manage.py collectstatic
CMD gunicorn --bind 0.0.0.0:8000 arpansahu_dot_me.wsgi
</code></pre>                
                            <h4><br>Now in your Git Repository, Create a file named docker-compose.yml and add following lines in it</h4>
<pre><code class="language-python">version: '3'

services:
  web:
    build: .
    env_file: ./.env
    command: bash -c "python manage.py makemigrations && python manage.py migrate && gunicorn --bind 0.0.0.0:8000 arpansahu_dot_me.wsgi"
    image: arpansahu_dot_me
    container_name: arpansahu_dot_me
    volumes:
      - .:/arpansahu_dot_me
    ports:
      - "8000:8000"
    restart: unless-stopped
</code></pre>               
                            <h4>What is Difference in Dockerfile and docker-compose.yml?</h4>
                            <p>
                              A Dockerfile is a simple text file that contains the commands a user could call to assemble an image whereas Docker Compose is a tool for defining and running multi-container Docker applications.<br>

                              Docker Compose define the services that make up your app in docker-compose.yml so they can be run together in an isolated environment. It gets an app running in one command by just running docker-compose up. Docker compose uses the Dockerfile if you add the build command to your project’s docker-compose.yml. Your Docker workflow should be to build a suitable Dockerfile for each image you wish to create, then use compose to assemble the images using the build command.<br>

                              Running Docker <br>

<pre><code class="language-python">docker compose up --build --detach 
</code></pre>   
                              --detach tag is for running the docker even if terminal is closed<br>
                              if you remove this tag it will be attached to terminal, and you will be able to see the logs too<br>

                              --build tag with docker compose up will force image to be rebuild every time before starting the container<br>
                            </p>
                            </p>

                            <h2><br>Step2: Serving the requests from Nginx</h2><br>
                            
                            <ol>
                              <li>Installing Nginx server: 
<pre><code class="language-python">sudo apt-get install nginx
</code></pre>                                  
                              </li>
                              <li>Starting Nginx and checking its status:
<pre><code class="language-python">sudo systemctl start nginx
sudo systemctl status nginx
</code></pre>     
                              </li>
                              <li>Modify DNS Configurations:<br>
                                <p>
                                  Add these two records to your DNS Configurations

<pre><code class="language-python">A Record	*	0.227.49.244 (public ip of ec2)	Automatic
A Record	@	0.227.49.244 (public ip of ec2)	Automatic
</code></pre>     

                                  Note: now you will be able to see nginx running page if you open public ip of the machine<br>

                                  Make Sure your EC2 security Group have this entry inbound rules 

<pre><code class="language-python">random-hash-id	IPv4	HTTP	TCP	80	0.0.0.0/0
</code></pre>  
                                  Open a new Nginx Configuration file name can be anything i am choosing arpansahu since my domain is arpansahu.me. there is already a default configuration file but we will leave it like that only

<pre><code class="language-python">sudo vi /etc/nginx/sites-available/arpansahu
</code></pre>  
                                  paste this content in the above file

<pre><code class="language-python">server_tokens               off;
access_log                  /var/log/nginx/supersecure.access.log;
error_log                   /var/log/nginx/supersecure.error.log;

server {
  server_name               arpansahu.me;        
  listen                    80;
  location / {
    proxy_pass              http://{ip_of_home_server/localhost}:8000;
    proxy_set_header        Host $host;
  }
}
</code></pre>  

                                  Basically this single Nginx File will be hosting all the multiple projects which I have listed before also.<br>

                                  Checking if configurations fie is correct<br>

<pre><code class="language-python">sudo service nginx configtest /etc/nginx/sites-available/arpansahu
</code></pre>  
                                  Now you need to symlink this file to the sites-enabled directory:

<pre><code class="language-python">cd /etc/nginx/sites-enabled
sudo ln -s ../sites-available/arpansahu
</code></pre>  

                                  Restarting Nginx Server 

<pre><code class="language-python">sudo systemctl restart nginx
</code></pre> 
                                  Now It's time to enable HTTPS for this server

                                </p>
                              </li>  
                            </ol>
                            <h2>Step3: Enabling HTTPS</h2>
                            <ol>
                              <li>Base Domain:  Enabling https for base domain only or a single sub domain<br>
                                <p>
                                  To allow visitors to access your site over HTTPS, you’ll need an SSL/TLS certificate that sits on your web server. Certificates are issued by a Certificate Authority (CA).We’ll use a free CA called Let’s Encrypt. To actually install the certificate, you can use the Certbot client, which gives you an utterly painless step-by-step series of prompts.<br>
                                  Before starting with Certbot, you can tell Nginx up front to disable TLS version 1.0 and 1.1 in favor of versions 1.2 and 1.3. TLS 1.0 is end-of-life (EOL), while TLS 1.1 contained several vulnerabilities that were fixed by TLS 1.2. To do this, open the file /etc/nginx/nginx.conf. Find the following line:<br>
                                  
                                  Open nginx.conf file end change ssl_protocols 
                                  
<pre><code class="language-python">sudo vi /etc/nginx/nginx.conf
                                  
From ssl_protocols TLSv1 TLSv1.1 TLSv1.2; to ssl_protocols TLSv1.2 TLSv1.3;
</code></pre>     
                                  Use this command to verify if nginx.conf file is correct or not
                                  
<pre><code class="language-python">sudo nginx -t
</code></pre> 
                                  Now you’re ready to install and use Certbot, you can use snap to install Certbot:
                                  
<pre><code class="language-python">sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
</code></pre>                      
                                  Now installing certificate
                                  
<pre><code class="language-python">sudo certbot --nginx --rsa-key-size 4096 --no-redirect
</code></pre>                            
                                  It will be asking for domain name then you can enter your base domain<br>
                                  I have generated ssl for arpansahu.me<br>
                                  
                                  Then a few questions will be asked by them answer them all and done your ssl certificate will be geerated<br>
                                  
                                  Now These lines will be added to your # Nginx configuration: /etc/nginx/sites-available/arpansahu
                                  
<pre><code class="language-python">listen 443 ssl;
ssl_certificate /etc/letsencrypt/live/www.supersecure.codes/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/www.supersecure.codes/privkey.pem;
include /etc/letsencrypt/options-ssl-nginx.conf;
ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
</code></pre>                                      
                                  Redirecting HTTP to HTTPS<br>
                                  Open nginx configuration file  and make it like this

<pre><code class="language-python">sudo vi /etc/nginx/sites-available/arpansahu
</code></pre>

<pre><code class="language-python">server_tokens               off;
access_log                  /var/log/nginx/supersecure.access.log;
error_log                   /var/log/nginx/supersecure.error.log;

server {
  server_name               arpansahu.me;
  listen                    80;
  return                    307 https://$host$request_uri;
}

server {

  location / {
    proxy_pass              http://{ip_of_home_server/ localhost}:8000;
    proxy_set_header        Host $host;
    
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/arpansahu.me/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/arpansahu.me/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
} 
</code></pre>                    
                                  You can dry run and check weather it's renewal is working or not

<pre><code class="language-python">sudo certbot renew --dry-run
</code></pre>
                                                             
                                  Note: this process was for arpansahu.me and not for all subdomains. For all subdomains we will have to setup a wildcard ssl certificate
                                </p>

                              </li>
                              <li>Enabling a Wildcard certificate<br>
                                <p>
                                  Here we will enable ssl certificate for all subdomains at once<br>
    
                                  Run following Command

<pre><code class="language-python">sudo certbot certonly --manual --preferred-challenges dns
</code></pre>                              
                                  Again you will be asked domain name and here you will use *.arpansahu.me. and second domain you will use is
                                  arpansahu.me.<br>
                                  
                                  Now, you should be having a question in your mind that why we are generating ssl for arpansahu.me separately.<br>
                                  It's because Let's Encrupt does not include base doamin with wildcard certificates for subdomains.<br>

                                  After running above command you will see a message similar to this

<pre><code class="language-python">Saving debug log to /var/log/letsencrypt/letsencrypt.log
Please enter the domain name(s) you would like on your certificate (comma and/or
space separated) (Enter 'c' to cancel): *.arpansahu.me
Requesting a certificate for *.arpansahu.me

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Please deploy a DNS TXT record under the name:

_acme-challenge.arpansahu.me.

with the following value:

dpWCxvq3mARF5iGzSfaRNXwmdkUSs0wgsTPhSaX1gK4

Before continuing, verify the TXT record has been deployed. Depending on the DNS
provider, this may take some time, from a few seconds to multiple minutes. You can
check if it has finished deploying with aid of online tools, such as the Google
Admin Toolbox: https://toolbox.googleapps.com/apps/dig/#TXT/_acme-challenge.arpansahu.me.
Look for one or more bolded line(s) below the line ';ANSWER'. It should show the
value(s) you've just added.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Press Enter to Continue
</code></pre>   
                                  You will be given a dns challenge called ACME challenger you have to create a dns TXT record in DNS.
                                  Similar to below record.
                                  
<pre><code class="language-python">TXT Record	_acme-challenge	dpWCxvq3mARF5iGzSfaRNXwmdkUSs0wgsTPhSaX1gK4	5 Automatic
</code></pre>        
                                  Now, use this url to verify records are updated or not <br>

                                  https://toolbox.googleapps.com/apps/dig/#TXT/_acme-challenge.arpansahu.me (arpansahu.me is domain)<br>

                                  If its verified then press enter the terminal as mentioned above<br>
                                  
                                  Then your certificate will be generated

<pre><code class="language-python">Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/arpansahu.me-0001/fullchain.pem            (use this in your nginx configuration file)
Key is saved at:         /etc/letsencrypt/live/arpansahu.me-0001/privkey.pem
This certificate expires on 2023-01-20.
These files will be updated when the certificate renews.
</code></pre>   
                                  You can notice here, certificate generated is arpansahu.me-0001 and not arpansahu.me<br>
                                  because we already generated a certificate named arpansahu.me<br>
                                  
                                  So remember to delete it before generating this wildcard certificate<br>
                                  using command

<pre><code class="language-python">sudo certbot delete
</code></pre>                               
                                  Note: This certificate will not be renewed automatically. Auto-renewal of --manual certificates requires the use of an authentication hook script (--manual-auth-hook) but one was not provided. To renew this certificate, repeat this same certbot command before the certificate's expiry date.
                                </p>  
                              </li>
                              <li>Generating Wildcard SSL certificate and Automating its renewal<br>
                                <ol>
                                  <li>Modify your ec2 inbound rules<br>
<pre><code class="language-python">–	sgr-0219f1387d28c96fb	IPv4	DNS (TCP)	TCP	53	0.0.0.0/0	–	
–	sgr-01b2b32c3cee53aa9	IPv4	SSH	TCP	22	0.0.0.0/0	–
–	sgr-0dfd03bbcdf60a4f7	IPv4	HTTP	TCP	80	0.0.0.0/0	–
–	sgr-02668dff944b9b87f	IPv4	HTTPS	TCP	443	0.0.0.0/0	–
–	sgr-013f089a3f960913c	IPv4	DNS (UDP)	UDP	53	0.0.0.0/0	–
</code></pre>         
                                  </li>
                                  <li>Install acme-dns Server<br>
                                    <ul>
                                      <li>Create folder for acme-dns and change directory
<pre><code class="language-python">sudo mkdir /opt/acme-dns
cd !$
</code></pre>  
                                      </li> 
                                      <li>Download and extract tar with acme-dns from GitHub
<pre><code class="language-python">sudo curl -L -o acme-dns.tar.gz \
https://github.com/joohoi/acme-dns/releases/download/v0.8/acme-dns_0.8_linux_amd64.tar.gz
sudo tar -zxf acme-dns.tar.gz
</code></pre>  
                                      </li> 
                                      <li>List files
<pre><code class="language-python">sudo ls
</code></pre> 
                                      </li>
                                      <li>Clean Up
<pre><code class="language-python">sudo rm acme-dns.tar.gz
</code></pre> 
                                      </li>
                                      <li>Create soft link
<pre><code class="language-python">sudo ln -s \
/opt/acme-dns/acme-dns /usr/local/bin/acme-dns
</code></pre> 
                                      </li>
                                      <li>Create a minimal acme-dns user

<pre><code class="language-python">sudo adduser \
--system \	
--gecos "acme-dns Service" \
--disabled-password \
--group \
--home /var/lib/acme-dns \
acme-dns
</code></pre>
                                      </li>
                                      <li>Update default acme-dns config compare with IP from the AWS console. CAn't bind to the public address need to use private one.<br>

<pre><code class="language-python">ip addr
	  
sudo mkdir -p /etc/acme-dns

sudo mv /opt/acme-dns/config.cfg /etc/acme-dns/

sudo vim /etc/acme-dns/config.cfg
</code></pre>                                        
                                      </li>  
                                      <li>Replace
<pre><code class="language-python">listen = "127.0.0.1:53” to listen = “private ip of the ec2 instance” 172.31.93.180:53(port will be 53)

Similarly Edit other details mentioned below  

# domain name to serve the requests off of
domain = "auth.arpansahu.me"
# zone name server
nsname = "auth.arpansahu.me"
# admin email address, where @ is substituted with .
nsadmin = "admin@arpansahu.me"


records = [
  # domain pointing to the public IP of your acme-dns server
    "auth.arpansahu.me. A 44.199.177.138. (public elastic ip)”,
  # specify that auth.example.org will resolve any *.auth.example.org records
    "auth.arpansahu.me. NS auth.arpansahu.me.”,
]

[api]
# listen ip eg. 127.0.0.1
ip = "127.0.0.1”. (Changed)

# listen port, eg. 443 for default HTTPS
port = "8080" (Changed).         ——— we will use port 8090 because we will also use Jenkins which will be running on 8080 port
# possible values: "letsencrypt", "letsencryptstaging", "cert", "none"
tls = "none"   (Changed)

</code></pre>                                        
                                      </li>
                                      <li>Move the systemd service and reload
<pre><code class="language-python">cat acme-dns.service
     
sudo mv \
acme-dns.service /etc/systemd/system/acme-dns.service

sudo systemctl daemon-reload
</code></pre>   
                                      </li>
                                      <li>Start and enable acme-dns server
<pre><code class="language-python">sudo systemctl enable acme-dns.service
sudo systemctl start acme-dns.service
</code></pre>                              
                                      </li>  
                                      <li>Check acme-dns for possible errors
<pre><code class="language-python">sudo systemctl status acme-dns.service
</code></pre>                                            
                                      </li>
                                      <li>Use journalctl to debug in case of errors
<pre><code class="language-python">journalctl --unit acme-dns --no-pager --follow
</code></pre>                                  
                                      </li>
                                      <li>Create A record for your domain
<pre><code class="language-python">auth.arpansahu.me IN A <public-ip>
</code></pre>                                  
                                      </li>
                                      <li>Create NS record for auth.arpansahu.me pointing to auth.arpansahu.me. This means, that auth.arpansahu.me is
                                        responsible for any *.auth.arpansahu.me records
<pre><code class="language-python">auth.arpansahu.me IN NS auth.arpansahu.me
</code></pre>                                  
                                      </li>
                                      <li>Your DNS record will be looking like this
<pre><code class="language-python">A Record	auth	44.199.177.138	Automatic	
NS Record	auth	auth.arpansahu.me.	Automatic
</code></pre>                                  
                                      </li>
                                      <li>Test acme-dns server (Split the screen)
<pre><code class="language-python">journalctl -u acme-dns --no-pager --follow
</code></pre>                                  
                                      </li>
                                      <li>From local host try to resolve random DNS record
<pre><code class="language-python">dig api.arpansahu.me
dig api.auth.arpansahu.me
dig 7gvhsbvf.auth.arpansahu.me
</code></pre>                                  
                                      </li>
                                    </ul>
                                  </li>
                                  <li>Install acme-dns-client<br>
<pre><code class="language-python">sudo mkdir /opt/acme-dns-client
cd !$

sudo curl -L \
-o acme-dns-client.tar.gz \
https://github.com/acme-dns/acme-dns-client/releases/download/v0.2/acme-dns-client_0.2_linux_amd64.tar.gz

sudo tar -zxf acme-dns-client.tar.gz
ls
sudo rm acme-dns-client.tar.gz
sudo ln -s \
/opt/acme-dns-client/acme-dns-client /usr/local/bin/acme-dns-client 
</code></pre>  
                                  </li>
                                  <li>Install Certbot<br>
<pre><code class="language-python">cd
sudo snap install core; sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
</code></pre>                             
                                  Note: you can skip step4 if Certbot is already installed<br>
                                  </li>
                                  <li>Get Letsencrypt Wildcard Certificate<br>
                                    <ul>
                                      <li>Create a new acme-dns account for your domain and set it up
<pre><code class="language-python">sudo acme-dns-client register \
-d arpansahu.me -s http://localhost:8090

Above command is old now we will use the new command 
         sudo acme-dns-client register \
          -d arpansahu.me \
          -allow 0.0.0.0/0 \
          -s http://localhost:8080

</code></pre> 
                                      Note: When we edited acme-dns config file there we mentioned the port 8090 and thats why we are using this port here also<br>
                                      </li>  
                                      <li>Creating Another DNS Entry 
<pre><code class="language-python">CNAME Record	_acme-challenge	e6ac0f0a-0358-46d6-a9d3-8dd41f44c7ec.auth.arpansahu.me.	Automatic
</code></pre> 
                                      Since the last update in  the last step now two more entries should be added<br>
<pre><code class="language-python">CAA Record @	0 issuewild "letsencrypt.org; validationmethods=dns-01; accounturi=https://acme-v02.api.letsencrypt.org/acme/acct/1424899626"  Automatic

CAA Record @	0 issue "letsencrypt.org; validationmethods=dns-01; accounturi=https://acme-v02.api.letsencrypt.org/acme/acct/1424899626"
Automatic
</code></pre> 
                                      Same as an entry is needed to be added to complete one time challenge as in previously we did.<br>
                                      </li>  
                                      <li>Check the entry is added successfully or not
<pre><code class="language-python">dig _acme-challenge.arpansahu.me
</code></pre> 
                                      </li>  
                                      <li>Get wildcard certificate
<pre><code class="language-python">sudo certbot certonly \
--manual \
--test-cert \ 
--preferred-challenges dns \ 
--manual-auth-hook 'acme-dns-client' \ 
-d ‘*.arpansahu.me’ -d arpansahu.me
</code></pre> 
                                      Note: Here we have to mention both the base and wildcard domain names with -d since let's encrypt don't provide base domain ssl by default in wildcard domain ssl<br>
                                      </li>  
                                      <li>Verifying the certificate
<pre><code class="language-python">sudo openssl x509 -text -noout \
-in /etc/letsencrypt/live/arpansahu.me/fullchain.pem
</code></pre> 
                                      </li>  
                                      <li>Renew certificate (test)
<pre><code class="language-python">sudo certbot renew \
--manual \ 
--test-cert \ 
--dry-run \ 
--preferred-challenges dns \
--manual-auth-hook 'acme-dns-client'       
</code></pre> 
                                      </li>
                                      <li>Renew certificate (actually)
<pre><code class="language-python">sudo certbot renew \
--manual \
--preferred-challenges dns \
--manual-auth-hook 'acme-dns-client'           
</code></pre> 
                                      </li>
                                      <li>Check the entry is added successfully or not
<pre><code class="language-python">dig _acme-challenge.arpansahu.me         
</code></pre> 
                                      </li>
                                    </ul>  
                                  </li>  
                                  <li>Setup Auto-Renew for Letsencrypt WILDCARD Certificate<br>
                                    <ul>
                                      <li>Setup cronjob
<pre><code class="language-python">sudo crontab -e      
</code></pre>                        
                                      </li>
                                      <li>Add following lines to the file
<pre><code class="language-python">0 */12 * * * certbot renew --manual --test-cert --preferred-challenges dns --manual-auth-hook 'acme-dns-client'
</code></pre>      
                                      </li>  
                                    </ul>
                                  </li>  
                                </ol>  
                                After all these steps your Nginx configuration file located at /etc/nginx/sites-available/arpansahu will be looking similar to this<br>
<pre><code class="language-python">server_tokens               off;
access_log                  /var/log/nginx/supersecure.access.log;
error_log                   /var/log/nginx/supersecure.error.log;

server {
    listen         80;
    server_name    arpansahu.me;
    # force https-redirects
    if ($scheme = http) {
        return 301 https://$server_name$request_uri;
        }

    location / {
          proxy_pass              http://{ip_of_home_server/ localhost}:8000;
          proxy_set_header        Host $host;
          proxy_set_header    X-Forwarded-Proto $scheme;

    # WebSocket support
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
    }
    
  

    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/arpansahu.me/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/arpansahu.me/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
</code></pre>                       
                              </li>  
                              <li>Step 4: CI/CD using Jenkins<br>
                                <p>
                                  Installing Jenkins

                                  <a href="https://www.jenkins.io/doc/book/installing/linux/" style="color: blue">Reference: </a>

                                  Jenkins requires Java in order to run, yet certain distributions don’t include this by default and some Java versions are incompatible with Jenkins.<br>

                                  There are multiple Java implementations which you can use. OpenJDK is the most popular one at the moment, we will use it in this guide.<br>

                                  Update the Debian apt repositories, install OpenJDK 11, and check the installation with the commands:

<pre><code class="language-python">sudo apt update

sudo apt install openjdk-11-jre

java -version
openjdk version "11.0.12" 2021-07-20
OpenJDK Runtime Environment (build 11.0.12+7-post-Debian-2)
OpenJDK 64-Bit Server VM (build 11.0.12+7-post-Debian-2, mixed mode, sharing)
</code></pre> 
                                  Long Term Support release

<pre><code class="language-python">curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \
  /usr/share/keyrings/jenkins-keyring.asc > /dev/null
echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
  /etc/apt/sources.list.d/jenkins.list > /dev/null
sudo apt-get update
sudo apt-get install jenkins
</code></pre> 
                                  Start Jenkins

<pre><code class="language-python">sudo systemctl enable jenkins
</code></pre> 
                                  You can start the Jenkins service with the command:

<pre><code class="language-python">sudo systemctl start jenkins
</code></pre> 

                                  You can check the status of the Jenkins service using the command:

<pre><code class="language-python">sudo systemctl status jenkins
</code></pre> 
                                  Now for serving the Jenkins UI from Nginx add these following lines to the Nginx file located at <br>
                                  /etc/nginx/sites-available/arpansahu by running the following command <br>

<pre><code class="language-python">sudo vi /etc/nginx/sites-available/arpansahu
</code></pre> 
                                  <ul>
                                    <li>Add these lines to it.
<pre><code class="language-python">server {
  listen         80;
  server_name    jenkins.arpansahu.me;
  # force https-redirects
  if ($scheme = http) {
      return 301 https://$server_name$request_uri;
      }

  location / {
      proxy_pass              http://{ip_of_home_server/ localhost}:8080;
      proxy_set_header        Host $host;
      proxy_set_header    X-Forwarded-Proto $scheme;
  }

  listen 443 ssl; # managed by Certbot
  ssl_certificate /etc/letsencrypt/live/arpansahu.me/fullchain.pem; # managed by Certbot
  ssl_certificate_key /etc/letsencrypt/live/arpansahu.me/privkey.pem; # managed by Certbot
  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
</code></pre>              
                                      You can add all the server blocks to the same nginx configuration file<br>
                                      just make sure you place the server block for base domain at the last<br>
                                    </li>  
                                    <li>
                                      To copy .env from local server directory while buidling image<br>
                                      add 
<pre><code class="language-python">Jenkins ALL=(ALL) NOPASSWD: ALL
</code></pre> 
                                    inside /etc/sudoers file<br>
                                    And then add <br>
<pre><code class="language-python">stage('Dependencies') {
  steps {
      script {
          sh "sudo cp /root/env/project_name/.env /var/lib/jenkins/workspace/project_name"
      }
  }
}
</code></pre> 
                                    
                          
                                    in jenkinsfile  
                                    </li>
                                    <li>Now Create a file named Jenkinsfile at the root of Git Repo and add following lines to file
<pre><code class="language-python">
pipeline {
  agent { label 'local' }
  stages {
      stage('Dependencies') {
          steps {
              script {
                  sh "sudo cp /root/env/project_name/.env /var/lib/jenkins/workspace/project_name"
              }
          }
      }
      stage('Production') {
          steps {
              script {
                  sh "docker compose up --build --detach"
              }
          }
      }
  }
  post {
      success {
          sh """curl -s \
          -X POST \
          --user $MAIL_JET_API_KEY:$MAIL_JET_API_SECRET \
          https://api.mailjet.com/v3.1/send \
          -H "Content-Type:application/json" \
          -d '{
              "Messages":[
                      {
                              "From": {
                                      "Email": "$MAIL_JET_EMAIL_ADDRESS",
                                      "Name": "ArpanSahuOne Jenkins Notification"
                              },
                              "To": [
                                      {
                                              "Email": "$MY_EMAIL_ADDRESS",
                                              "Name": "Development Team"
                                      }
                              ],
                              "Subject": "${currentBuild.fullDisplayName} deployed succcessfully",
                              "TextPart": "Hola Development Team, your project ${currentBuild.fullDisplayName} is now deployed",
                              "HTMLPart": "<h3>Hola Development Team, your project ${currentBuild.fullDisplayName} is now deployed </h3> <br> <p> Build Url: ${env.BUILD_URL}  </p>"
                      }
              ]
          }'"""
      }
      failure {
          sh """curl -s \
          -X POST \
          --user $MAIL_JET_API_KEY:$MAIL_JET_API_SECRET \
          https://api.mailjet.com/v3.1/send \
          -H "Content-Type:application/json" \
          -d '{
              "Messages":[
                      {
                              "From": {
                                      "Email": "$MAIL_JET_EMAIL_ADDRESS",
                                      "Name": "ArpanSahuOne Jenkins Notification"
                              },
                              "To": [
                                      {
                                              "Email": "$MY_EMAIL_ADDRESS",
                                              "Name": "Developer Team"
                                      }
                              ],
                              "Subject": "${currentBuild.fullDisplayName} deployment failed",
                              "TextPart": "Hola Development Team, your project ${currentBuild.fullDisplayName} deployment failed",
                              "HTMLPart": "<h3>Hola Development Team, your project ${currentBuild.fullDisplayName} is not deployed, Build Failed </h3> <br> <p> Build Url: ${env.BUILD_URL}  </p>"
                      }
              ]
          }'"""
      }
  }
}
</code></pre>               
                                        Note: agent {label 'local'} is used to specify which node will execute the jenkins job deployment. Basically there are two nodes in this project 
                                        One is my local Linux Server and Another is AWS EC2 machine where nginx is hosted there arpansahu.me my portfolio is also hosted is also hosted.
                                        So local linux server is labelled with 'local' are the project with this label will be executed in local machine node.

                                    </li> 
                                    <li>Configure a Jenkins project from jenkins ui located at https://jenkins.arpansahu.me<br>
                                      Make sure to use Pipline project and name it whatever you want I have named it as arpansahu_me<br>
                                      <img class="d-block w-100" src="{% static 'images/Jenkins Configuration/Arpan-Sahu-Dot-Me-Config-Jenkins-.png' %}" alt="Jenkins Project for ArpanSahuDotMe Configuration File" />

                                      In this above picture you can see credentials right? you can add your github credentials<br>
                                      from Manage Jenkins on home Page --> Manage Credentials<br>

                                      and add your GitHub credentials from there<br>

                                      <ul>
                                        <li> Add a .env file to you project using following command (This step is no more required stage('Dependencies'))
<pre><code class="language-python">sudo vi  /var/lib/jenkins/workspace/arpansahu_dot_me/.env
</code></pre>                               
                                            Your workspace name may be different.<br>

                                            Add all the env variables as required and mentioned in the Readme File.<br>
                                        </li>
                                        <li>Add Global Jenkins Variables from Dashboard --> Manage --> Jenkins -> Configure System <br>
                                          <ul>
                                            <li>MAIL_JET_API_KEY</li>
                                            <li>MAIL_JET_API_SECRET</li>
                                            <li>MAIL_JET_EMAIL_ADDRESS</li>
                                            <li>MY_EMAIL_ADDRESS</li>
                                          </ul>
                                        </li>  
                                      </ul>  
                                    </li> 
                                  </ul>

                                  Now you are good to go.
                                </p>  
                              </li>  
                            </ol>

                            <h2><br>Environment Variables</h2><hr>
                            <p>To run this project, you will need to add the following environment variables to your .env file</p>
<pre><code class="language-python">
EMAIL=

PASS=

MY_EMAIL_ADDRESS=

DATABASE_URL=

REDISCLOUD_URL=

SECRET_KEY=

DEBUG=

ALLOWED_HOSTS=

MAIL_JET_API_KEY=

MAIL_JET_API_SECRET=

MAIL_JET_EMAIL_ADDRESS=

DOMAIN=

PROTOCOL=

DROPBOX_ACCESS_TOKEN=

AWS_ACCESS_KEY_ID=

AWS_SECRET_ACCESS_KEY=

AWS_STORAGE_BUCKET_NAME=

# Blackblaze bucket instead of AWS S3 bucket

AWS_S3_REGION_NAME=

BUCKET_TYPE=
</code></pre>
                    </div>
            </div>
          </div>
        </div>
     </div>
{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
    <script>
    <!-- Copy Button JS -->
    const copyButtonLabel = "Copy Code";

    // you can use a class selector instead if you, or the syntax highlighting library adds one to the 'pre'.
    let blocks = document.querySelectorAll("pre");

    blocks.forEach((block) => {
      // only add button if browser supports Clipboard API
      if (navigator.clipboard) {
        let button = document.createElement("copy-button");
        button.innerText = copyButtonLabel;
        button.addEventListener("click", copyCode);
        block.appendChild(button);
      }
    });

    async function copyCode(event) {
      const button = event.srcElement;
      const pre = button.parentElement;
      let code = pre.querySelector("code");
      let text = code.innerText;
      await navigator.clipboard.writeText(text);

      button.innerText = "Code Copied";

      setTimeout(()=> {
        button.innerText = copyButtonLabel;
      },1000)
    }
    <!-- Copy Button JS ends-->
    </script>
{% endblock javascripts %}